{
    "name": "Command Injection Rules",
    "version": "2.0.0",
    "description": "Enhanced detection rules for OS command injection attacks",
    "rules": [
        {"id": "cmd-001", "name": "Command Separators", "description": "Detects command separators", "pattern": "(?:[;|`]|\\$\\(|&&|\\|\\||\\n|%0[aAdD])", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce"]},
        {"id": "cmd-002", "name": "Backtick Execution", "description": "Detects backtick command execution", "pattern": "`[^`]+`", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce"]},
        {"id": "cmd-003", "name": "Command Substitution", "description": "Detects $() command substitution", "pattern": "\\$\\([^)]+\\)", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce"]},
        {"id": "cmd-004", "name": "Dangerous Commands", "description": "Detects common dangerous commands", "pattern": "(?i)(?:(?:^|[;&|`])\\s*(?:cat|ls|dir|rm|mv|cp|wget|curl|nc|netcat|bash|sh|zsh|python|perl|ruby|php|node|id|whoami|uname)\\s)", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce"]},
        {"id": "cmd-005", "name": "System Paths", "description": "Detects references to system binaries", "pattern": "(?i)(?:/bin/(?:bash|sh|cat|ls|rm|chmod)|/usr/bin/(?:wget|curl|python|perl)|cmd\\.exe|powershell)", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce"]},
        {"id": "cmd-006", "name": "Environment Variables", "description": "Detects environment variable access", "pattern": "\\$(?:IFS|PATH|HOME|USER|SHELL|PWD|HOSTNAME|LANG|TERM)", "operator": "regex", "enabled": true, "severity": "high", "tags": ["rce"]},
        {"id": "cmd-007", "name": "Reverse Shell", "description": "Detects reverse shell patterns", "pattern": "(?i)(?:bash\\s+-i|nc\\s+-[el]|/dev/tcp/|mkfifo|mknod|telnet\\s+\\d|ncat\\s+-|socat\\s+)", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce", "reverse-shell"]},
        {"id": "cmd-008", "name": "Encoded Commands", "description": "Detects encoded command execution", "pattern": "(?i)(?:base64\\s+-d|eval\\s+|exec\\s+|source\\s+)", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce", "evasion"]},
        {"id": "cmd-009", "name": "Standalone Commands", "description": "Detects standalone dangerous commands", "pattern": "(?i)(?:^|=|\\s)(?:cat|whoami|id|uname|pwd|hostname|ifconfig|ipconfig|netstat|ps|env|printenv)(?:$|\\s|%20)", "operator": "regex", "enabled": true, "severity": "high", "tags": ["rce"]},
        {"id": "cmd-010", "name": "Sensitive File Read", "description": "Detects sensitive file reading", "pattern": "(?i)(?:cat|head|tail|less|more|type)\\s+.*(?:/etc/passwd|/etc/shadow|\\.htpasswd|\\.env)", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce"]},
        {"id": "cmd-011", "name": "System Info Commands", "description": "Detects system info gathering", "pattern": "(?i)(?:uname\\s+-a|cat\\s+/etc/passwd|lsb_release|hostnamectl|systemctl|ver\\s*$)", "operator": "regex", "enabled": true, "severity": "high", "tags": ["rce", "recon"]},
        {"id": "cmd-012", "name": "Download Execute", "description": "Detects download and execute", "pattern": "(?i)(?:wget|curl|fetch)\\s+.*(?:http|ftp).*(?:\\||;|&&|>)", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce", "malware"]},
        {"id": "cmd-013", "name": "File Write Operations", "description": "Detects file write commands", "pattern": "(?i)(?:echo|printf|cat)\\s+.*>+\\s*(?:/tmp/|/var/|/etc/)", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce"]},
        {"id": "cmd-014", "name": "Permission Modification", "description": "Detects chmod/chown commands", "pattern": "(?i)(?:chmod|chown|chgrp)\\s+(?:[0-7]{3,4}|\\+[rwxs]|[ugoa][+-])", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce"]},
        {"id": "cmd-015", "name": "Process Manipulation", "description": "Detects kill commands", "pattern": "(?i)(?:kill|killall|pkill)\\s+-?[0-9]*", "operator": "regex", "enabled": true, "severity": "high", "tags": ["rce"]},
        {"id": "cmd-016", "name": "Cron Job", "description": "Detects cron manipulation", "pattern": "(?i)(?:crontab|/etc/cron|/var/spool/cron)", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce", "persistence"]},
        {"id": "cmd-017", "name": "Network Tools", "description": "Detects network recon tools", "pattern": "(?i)(?:ping|traceroute|nslookup|dig|nmap|masscan)\\s+", "operator": "regex", "enabled": true, "severity": "high", "tags": ["rce", "recon"]},
        {"id": "cmd-018", "name": "Archive Extraction", "description": "Detects archive commands", "pattern": "(?i)(?:tar\\s+.*-?[xz]|unzip|gunzip|7z\\s+[ex])\\s+", "operator": "regex", "enabled": true, "severity": "high", "tags": ["rce"]},
        {"id": "cmd-019", "name": "SSH Commands", "description": "Detects SSH commands", "pattern": "(?i)(?:ssh\\s+-|scp\\s+|ssh-keygen|authorized_keys)", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce"]},
        {"id": "cmd-020", "name": "Database CLI", "description": "Detects database CLI", "pattern": "(?i)(?:mysql\\s+-|psql\\s+-|sqlite3|mongo\\s+|redis-cli)", "operator": "regex", "enabled": true, "severity": "high", "tags": ["rce"]},
        {"id": "cmd-021", "name": "Windows Commands", "description": "Detects Windows commands", "pattern": "(?i)(?:cmd\\.exe|powershell|wscript|mshta|certutil|bitsadmin|regsvr32|net\\s+user|sc\\s+create)", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce", "windows"]},
        {"id": "cmd-022", "name": "Newline Injection", "description": "Detects newline injection", "pattern": "(?:%0[aAdD]|\\\\r|\\\\n|\\x0a|\\x0d)", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce"]},
        {"id": "cmd-023", "name": "Script One-liners", "description": "Detects script one-liners", "pattern": "(?i)(?:python\\s+-c|perl\\s+-e|ruby\\s+-e|php\\s+-r)\\s*['\"]", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce"]},
        {"id": "cmd-024", "name": "Parameter Commands", "description": "Detects commands in params", "pattern": "(?:=|%3D)\\s*(?:cat|whoami|id|pwd|ls|echo|wget|curl|nc|sh|bash)(?:$|%20|\\+|\\s|&)", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce"]},
        {"id": "cmd-025", "name": "Shell Execution", "description": "Detects shell execution", "pattern": "(?i)(?:^|[=\\s&;|])(?:sh|bash|zsh|ksh|csh|dash)(?:\\s+-[cxeils]|\\s+[\"'/]|$|\\s)", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce"]},
        {"id": "cmd-026", "name": "Echo Command", "description": "Detects echo with redirect", "pattern": "(?i)(?:^|[=\\s&;|])echo\\s+.*(?:>|\\||;|`|\\$\\()", "operator": "regex", "enabled": true, "severity": "high", "tags": ["rce"]},
        {"id": "cmd-027", "name": "Destructive rm", "description": "Detects rm -rf", "pattern": "(?i)(?:^|[=\\s&;|])rm\\s+(?:-[rRfF]+\\s*)+", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce", "destructive"]},
        {"id": "cmd-028", "name": "Directory Listing", "description": "Detects ls command", "pattern": "(?i)(?:^|[=\\s&;|])ls\\s+(?:-[alRh]+\\s*)*(?:/|\\.\\.|\\.)", "operator": "regex", "enabled": true, "severity": "medium", "tags": ["rce"]},
        {"id": "cmd-029", "name": "File Operations", "description": "Detects file manipulation", "pattern": "(?i)(?:^|[=\\s&;|])(?:touch|mkdir|rmdir|mv|cp|ln)\\s+.*(?:/|\\.\\.)", "operator": "regex", "enabled": true, "severity": "high", "tags": ["rce"]},
        {"id": "cmd-030", "name": "Text Processing", "description": "Detects text processing commands", "pattern": "(?i)(?:^|[=\\s&;|])(?:awk|sed|grep|cut|sort|uniq|head|tail|wc)\\s+", "operator": "regex", "enabled": true, "severity": "medium", "tags": ["rce"]},
        {"id": "cmd-031", "name": "URL Encoded Commands", "description": "Detects URL encoded commands", "pattern": "(?:%73%68|%62%61%73%68|%63%61%74|%77%68%6f%61%6d%69|%72%6d|%65%63%68%6f)", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce", "evasion"]},
        {"id": "cmd-032", "name": "System File Read", "description": "Detects reading sensitive paths", "pattern": "(?i)(?:cat|head|strings|xxd)\\s+[\"']?(?:/etc/|/proc/|/var/|/root/|~)", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce"]},
        {"id": "cmd-033", "name": "Redirect to File", "description": "Detects output redirection", "pattern": "(?:>+|%3E+)\\s*(?:/|%2F|\\.|%2E)", "operator": "regex", "enabled": true, "severity": "high", "tags": ["rce"]},
        {"id": "cmd-034", "name": "Privilege Escalation", "description": "Detects sudo/su commands", "pattern": "(?i)(?:^|[=\\s&;|])(?:sudo|su|doas|pkexec)\\s+", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce"]},
        {"id": "cmd-035", "name": "Service Control", "description": "Detects service commands", "pattern": "(?i)(?:^|[=\\s&;|])(?:systemctl|service)\\s+(?:start|stop|restart|enable|disable)", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce"]},
        {"id": "cmd-036", "name": "Package Manager", "description": "Detects package manager", "pattern": "(?i)(?:^|[=\\s&;|])(?:apt|yum|dnf|pacman|pip|npm)\\s+(?:install|remove|update)", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce"]},
        {"id": "cmd-037", "name": "Disk Commands", "description": "Detects disk commands", "pattern": "(?i)(?:^|[=\\s&;|])(?:mount|umount|fdisk|mkfs|dd)\\s+", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce"]},
        {"id": "cmd-038", "name": "User Management", "description": "Detects user management", "pattern": "(?i)(?:^|[=\\s&;|])(?:useradd|userdel|usermod|passwd|adduser)\\s+", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce"]},
        {"id": "cmd-039", "name": "Log Tampering", "description": "Detects log tampering", "pattern": "(?i)(?:/var/log/|auth\\.log|secure|syslog|access\\.log|error\\.log)", "operator": "regex", "enabled": true, "severity": "high", "tags": ["rce"]},
        {"id": "cmd-040", "name": "Variable Expansion", "description": "Detects shell variable expansion", "pattern": "(?:\\$\\{[^}]+\\}|\\$[a-zA-Z_][a-zA-Z0-9_]*)", "operator": "regex", "enabled": true, "severity": "high", "tags": ["rce"]},
        {"id": "cmd-041", "name": "Process Substitution", "description": "Detects process substitution", "pattern": "(?:<\\([^)]+\\)|>\\([^)]+\\))", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce"]},
        {"id": "cmd-042", "name": "Here Documents", "description": "Detects here documents", "pattern": "<<\\s*['\"]?\\w+['\"]?", "operator": "regex", "enabled": true, "severity": "high", "tags": ["rce"]},
        {"id": "cmd-043", "name": "Brace Expansion", "description": "Detects bash brace expansion", "pattern": "\\{[^}]*,[^}]*\\}", "operator": "regex", "enabled": true, "severity": "high", "tags": ["rce", "evasion"]},
        {"id": "cmd-044", "name": "xargs Execution", "description": "Detects xargs command execution", "pattern": "(?i)(?:xargs|find\\s+.*-exec)\\s+", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce"]},
        {"id": "cmd-045", "name": "Busybox Commands", "description": "Detects busybox usage", "pattern": "(?i)busybox\\s+(?:sh|wget|nc|cat|ls|rm)", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce"]},
        {"id": "cmd-046", "name": "Docker Escape", "description": "Detects docker escape attempts", "pattern": "(?i)(?:docker\\s+(?:run|exec)|nsenter|chroot\\s+)", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce", "container"]},
        {"id": "cmd-047", "name": "AWS CLI", "description": "Detects AWS CLI commands", "pattern": "(?i)(?:aws\\s+(?:s3|ec2|iam|lambda|sts)|gcloud\\s+|az\\s+(?:vm|storage))", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce", "cloud"]},
        {"id": "cmd-048", "name": "Git Commands", "description": "Detects git command injection", "pattern": "(?i)(?:git\\s+(?:clone|pull|fetch|checkout|remote|config))", "operator": "regex", "enabled": true, "severity": "high", "tags": ["rce"]},
        {"id": "cmd-049", "name": "IFS Bypass", "description": "Detects IFS manipulation", "pattern": "(?:IFS\\s*=|\\$IFS|\\${IFS})", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce", "evasion"]},
        {"id": "cmd-050", "name": "Obfuscated Commands", "description": "Detects obfuscated commands", "pattern": "(?:\\$['\"]|\\\\x[0-9a-f]{2}|\\$'\\\\|rev<<<|base64<<<)", "operator": "regex", "enabled": true, "severity": "critical", "tags": ["rce", "evasion"]}
    ]
}
